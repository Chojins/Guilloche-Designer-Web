<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guilloche Pattern Generator</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { display: flex; flex-direction: column; align-items: center; }
        canvas { border: 1px solid black; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Guilloche Pattern Generator</h1>

        <div>
            <label for="M1Period">M1 Period:</label>
            <input type="number" id="M1Period" value="1" step="0.1" />
        </div>
        <div>
            <label for="M2Period">M2 Period:</label>
            <input type="number" id="M2Period" value="1" step="0.1" />
        </div>
        <div>
            <label for="M3Period">M3 Period:</label>
            <input type="number" id="M3Period" value="1" step="0.1" />
        </div>
        <div>
            <label for="aLength">M1 Radius:</label>
            <input type="number" id="aLength" value="100" />
        </div>
        <div>
            <label for="bLength">Link Length:</label>
            <input type="number" id="bLength" value="200" />
        </div>
        <div>
            <label for="cLength">Link Length:</label>
            <input type="number" id="cLength" value="150" />
        </div>
        <div>
            <label for="M2Length">M2 Radius:</label>
            <input type="number" id="M2Length" value="50" />
        </div>
        <button id="generateButton">Generate Pattern</button>

        <canvas id="patternCanvas" width="500" height="500"></canvas>

        <button id="saveButton">Save SVG</button>
    </div>

    <script>
        const canvas = document.getElementById("patternCanvas");
        const ctx = canvas.getContext("2d");

        document.getElementById("generateButton").addEventListener("click", generatePattern);

        function generatePattern() {
            const M1Period = parseFloat(document.getElementById("M1Period").value);
            const M2Period = parseFloat(document.getElementById("M2Period").value);
            const M3Period = parseFloat(document.getElementById("M3Period").value);
            const aLength = parseFloat(document.getElementById("aLength").value);
            const bLength = parseFloat(document.getElementById("bLength").value);
            const cLength = parseFloat(document.getElementById("cLength").value);
            const M2Length = parseFloat(document.getElementById("M2Length").value);
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            let XPointList = [];
            let YPointList = [];
            let t = 0;
            let iterations = 100; // You can adjust iterations for smoother patterns

            // Periodic motors' calculations and drawing
            for (let i = 0; i < iterations; i++) {
                const theta2 = 2 * Math.PI * (t / M1Period);
                const m1x = aLength * Math.cos(theta2);
                const m1y = aLength * Math.sin(theta2);

                const m2x = -M2Length * Math.cos(2 * Math.PI * (t / M2Period));
                const m2y = -M2Length * Math.sin(2 * Math.PI * (t / M2Period));

                const dlength = Math.sqrt(Math.pow(m2x - m1x, 2) + Math.pow(m2y - m1y, 2));
                const k1 = dlength / aLength;
                const k2 = dlength / cLength;
                const k3 = (Math.pow(aLength, 2) + Math.pow(cLength, 2) + Math.pow(dlength, 2) - Math.pow(bLength, 2)) / (2 * aLength * cLength);

                // Calculate linkage
                const Cterm = k1 - (k2 + 1) * Math.cos(theta2) + k3;
                const Bterm = -2 * Math.sin(theta2);
                const Aterm = Math.cos(theta2) - k1 - k2 * Math.cos(theta2) + k3;
                const Theta4 = 2 * Math.atan(-Bterm - Math.sqrt(Math.pow(Bterm, 2) - 4 * Aterm * Cterm)) + Math.PI / 4;
                const xlink = cLength * Math.cos(Theta4) + m2x;
                const ylink = cLength * Math.sin(Theta4) + m2y;

                // Append points for SVG generation
                XPointList.push(xlink);
                YPointList.push(ylink);
                
                t += 0.01; // Time step
            }

            // Draw pattern on canvas
            ctx.beginPath();
            ctx.moveTo(XPointList[0] + canvas.width / 2, YPointList[0] + canvas.height / 2);
            for (let i = 1; i < XPointList.length; i++) {
                ctx.lineTo(XPointList[i] + canvas.width / 2, YPointList[i] + canvas.height / 2);
            }
            ctx.stroke();
        }

        document.getElementById("saveButton").addEventListener("click", saveSVG);

        function saveSVG() {
            let svgContent = `<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">`;
            svgContent += "<path d='M ";
            for (let i = 0; i < XPointList.length; i++) {
                svgContent += `${XPointList[i] + 250},${YPointList[i] + 250} `;
            }
            svgContent += "' fill='none' stroke='black' stroke-width='0.5'/>";
            svgContent += "</svg>";
            
            const blob = new Blob([svgContent], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "guilloche_pattern.svg";
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
